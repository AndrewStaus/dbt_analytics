{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.8", "generated_at": "2025-06-25T22:08:33.478462Z", "invocation_id": "25ec4c91-b559-40e6-8c09-1e7278e3a81a", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.157463Z", "completed_at": "2025-06-25T22:08:31.195462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.197468Z", "completed_at": "2025-06-25T22:08:31.197468Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04900670051574707, "adapter_response": {}, "message": null, "failures": null, "unique_id": "analysis.analytics.backfill", "compiled": true, "compiled_code": "with hits as (\r\n    select *\r\n    from (\r\n       values \r\n        ('2024-01-01 00:00:00', 11111, 'summer_sale'), \r\n        ('2024-01-01 00:02:00', 11111, null),\r\n        ('2024-01-01 00:03:00', 11111, 'winter_sale'),\r\n        ('2024-01-01 00:04:00', 11111, 'spring_sale'),\r\n        ('2024-01-01 00:00:00', 22222, 'summer_sale'),\r\n        ('2024-01-01 00:02:00', 22222, null),\r\n        ('2024-01-01 00:03:00', 22222, null),\r\n        ('2024-01-01 00:04:00', 22222, 'spring_sale'),\r\n        ('2024-01-01 00:05:00', 22222, null),\r\n        ('2024-01-01 00:00:00', 33333, null),\r\n        ('2024-01-01 00:02:00', 33333, null),\r\n        ('2024-01-01 00:03:00', 33333, null),\r\n        ('2024-01-01 00:04:00', 33333, 'spring_sale')\r\n    ) as t (date_time, entity_id, campaign)\r\n),\r\n\r\nx as (\r\n    select\r\n        *,\r\n        nvl(campaign,\r\n            first_value(campaign) ignore nulls over (\r\n                partition by entity_id\r\n                order by date_time\r\n            )\r\n        ) campaign2,\r\n        case when campaign is null\r\n            then null\r\n            else date_time\r\n        end date_time2\r\n    from hits\r\n)\r\n\r\nselect distinct\r\n    entity_id,\r\n    campaign2 campaign,\r\n    nvl(date_time2,\r\n        first_value(date_time2) ignore nulls over (\r\n            partition by entity_id\r\n            order by date_time\r\n        )\r\n    ) start_time,\r\nfrom x\r\nwhere campaign2 is not null\r\norder by entity_id, start_time", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.292465Z", "completed_at": "2025-06-25T22:08:31.296462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.300463Z", "completed_at": "2025-06-25T22:08:31.300463Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.024998903274536133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.accounts_db_accounts", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.302463Z", "completed_at": "2025-06-25T22:08:31.307465Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.316462Z", "completed_at": "2025-06-25T22:08:31.316462Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03599667549133301, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.adobe_experience_app_clickstream_hits", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.308464Z", "completed_at": "2025-06-25T22:08:31.313465Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.319462Z", "completed_at": "2025-06-25T22:08:31.319462Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.028998851776123047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.adobe_experience_web_clickstream_hits", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.330463Z", "completed_at": "2025-06-25T22:08:31.333462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.338467Z", "completed_at": "2025-06-25T22:08:31.338467Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01700139045715332, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.csparc_transactions", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.341465Z", "completed_at": "2025-06-25T22:08:31.345462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.357462Z", "completed_at": "2025-06-25T22:08:31.358464Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.031001806259155273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.facebook_ads_campaigns", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.346463Z", "completed_at": "2025-06-25T22:08:31.349462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.359462Z", "completed_at": "2025-06-25T22:08:31.359462Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.031000137329101562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.google_ads_campaigns", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.350462Z", "completed_at": "2025-06-25T22:08:31.355463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.361462Z", "completed_at": "2025-06-25T22:08:31.361462Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.031999826431274414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.reltio_individual_email", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.370464Z", "completed_at": "2025-06-25T22:08:31.374462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.378462Z", "completed_at": "2025-06-25T22:08:31.378462Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01599884033203125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.reltio_individual_party_keys", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.380462Z", "completed_at": "2025-06-25T22:08:31.383462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.434461Z", "completed_at": "2025-06-25T22:08:31.434461Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06799864768981934, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.analytics.rms_products", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.384462Z", "completed_at": "2025-06-25T22:08:31.485463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.491462Z", "completed_at": "2025-06-25T22:08:31.491462Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.12299990653991699, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_accounts_db__accounts", "compiled": true, "compiled_code": "with  __dbt__cte__src_accounts_db_accounts as (\n\n\nwith accounts as (\n    select * from analytics.external.accounts_db_accounts\n)\n\nselect\n    id         ::STRING    account_id,\n    party_key  ::STRING    party_key,\n    first_name ::STRING    first_name,\n    last_name  ::STRING    last_name,\n    loaded_at  ::TIMESTAMP loaded_at\nfrom accounts\n), accounts as (\n    select * from __dbt__cte__src_accounts_db_accounts\n)\n\nselect\n    account_id,\n    party_key individual_party_key,\n    (sha2(lower(trim(first_name :: string)), 256)) first_name,\n    (sha2(lower(trim(last_name :: string)), 256)) last_name,\n    loaded_at\nfrom accounts\n\nwhere loaded_at >= (select max(loaded_at) from analytics.accounts_db.accounts )\nqualify row_number() over (partition by account_id order by loaded_at desc) = 1", "relation_name": "analytics.accounts_db.accounts", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.406465Z", "completed_at": "2025-06-25T22:08:31.490463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.493462Z", "completed_at": "2025-06-25T22:08:31.493462Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.12400007247924805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_accounts_db__accounts_pii", "compiled": true, "compiled_code": "with  __dbt__cte__src_accounts_db_accounts as (\n\n\nwith accounts as (\n    select * from analytics.external.accounts_db_accounts\n)\n\nselect\n    id         ::STRING    account_id,\n    party_key  ::STRING    party_key,\n    first_name ::STRING    first_name,\n    last_name  ::STRING    last_name,\n    loaded_at  ::TIMESTAMP loaded_at\nfrom accounts\n), accounts as (\n    select * from __dbt__cte__src_accounts_db_accounts\n)\n\nselect\n    account_id,\n    lower(trim(first_name :: string)) first_name,\n    lower(trim(last_name :: string)) last_name,\n    loaded_at\nfrom accounts\n\nwhere loaded_at >= (select max(loaded_at) from analytics.accounts_db.accounts_pii )\nqualify row_number() over (partition by account_id order by loaded_at desc) = 1", "relation_name": "analytics.accounts_db.accounts_pii", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.441462Z", "completed_at": "2025-06-25T22:08:31.497462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.501464Z", "completed_at": "2025-06-25T22:08:31.501464Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.06399893760681152, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_csparc__transactions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__src_csparc_transactions as (\n\n\nwith orders as (\n    select * from analytics.external.csparc_transactions\n)\n\nselect\n    channel      ::STRING        channel,\n    date_time    ::TIMESTAMP     date_time,\n    party_key    ::STRING        party_key,\n    order_id     ::INT           order_id,\n    product_id   ::STRING        product_id,\n    revenue/100  ::DECIMAL(12,2) revenue,\n    margin/100   ::DECIMAL(12,2) margin,\n    loaded_at    ::TIMESTAMP     loaded_at\nfrom orders\n), orders as (\n    select * from __dbt__cte__src_csparc_transactions\n)\n\nselect\n    (convert_timezone('America/Vancouver', 'UTC', date_time)) transacted_at,\n    channel                       sales_channel,\n    party_key                     individual_party_key,\n    order_id                      transaction_id,\n    product_id                    product_id,\n    revenue                       revenue,\n    margin                        margin,\n    loaded_at                     loaded_at\nfrom orders\n\nwhere loaded_at >= (select max(loaded_at) from analytics.csparc.transactions)\nqualify row_number() over (partition by transaction_id order by loaded_at desc) = 1", "relation_name": "analytics.csparc.transactions", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.466463Z", "completed_at": "2025-06-25T22:08:31.500464Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.505464Z", "completed_at": "2025-06-25T22:08:31.505464Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06500053405761719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_google_ads__campaigns", "compiled": true, "compiled_code": "with\n __dbt__cte__src_google_ads_campaigns as (\n\n\nwith campaigns as (\n    select * from analytics.external.google_ads_campaigns\n)\n\nselect\n    'google_ads'                          ::STRING    marketing_channel,\n    JSON_EXTRACT_PATH_TEXT(DATA, 'id')    ::INT       id,\n    JSON_EXTRACT_PATH_TEXT(DATA, 'name')  ::STRING    name,\n    JSON_EXTRACT_PATH_TEXT(DATA, 'start') ::TIMESTAMP campaign_start_at,\n    loaded_at                             ::TIMESTAMP loaded_at\nfrom campaigns\n), campaigns as (\n    select * from __dbt__cte__src_google_ads_campaigns\n),\ncampaigns_conformed as (\n    select\n        marketing_channel marketing_channel,\n        id                campaign_id,\n        name              campaign_name,\n        campaign_start_at campaign_start_at,\n        loaded_at         loaded_at\n    from campaigns\n)\n\nselect\n    (sha2(concat_ws(':', nvl(campaign_id:: string, ''), nvl(marketing_channel:: string, '')),256)) campaign_sid,\n    *\nfrom campaigns_conformed\nwhere loaded_at >= (select max(loaded_at) from analytics.google_ads.campaigns)\nqualify row_number() over (partition by campaign_id order by loaded_at desc) = 1", "relation_name": "analytics.google_ads.campaigns", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.508464Z", "completed_at": "2025-06-25T22:08:31.564463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.592462Z", "completed_at": "2025-06-25T22:08:31.592462Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.09399890899658203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_facebook_ads__campaigns", "compiled": true, "compiled_code": "\n\nwith\n __dbt__cte__src_facebook_ads_campaigns as (\n\n\nwith campaigns as (\n    select * from analytics.external.facebook_ads_campaigns\n)\n\nselect\n    'facebook_ads'                             ::STRING    marketing_channel,\n    JSON_EXTRACT_PATH_TEXT(DATA, 'id')         ::INT       id,\n    JSON_EXTRACT_PATH_TEXT(DATA, 'name')       ::STRING    name,\n    JSON_EXTRACT_PATH_TEXT(DATA, 'start_date') ::TIMESTAMP start_date,\n    loaded_at                                  ::TIMESTAMP loaded_at\nfrom campaigns\n), campaigns as (\n    select * from __dbt__cte__src_facebook_ads_campaigns\n),\ncampaigns_conformed as (\n    select\n        marketing_channel marketing_channel,\n        id                campaign_id,\n        name              campaign_name,\n        start_date        campaign_start_at,\n        loaded_at         loaded_at\n    from campaigns\n)\n\nselect\n    (sha2(concat_ws(':', nvl(campaign_id:: string, ''), nvl(marketing_channel:: string, '')),256)) campaign_sid,\n    *\nfrom campaigns_conformed\nwhere loaded_at >= (select max(loaded_at) from analytics.facebook_ads.campaigns)\nqualify row_number() over (partition by campaign_id order by loaded_at desc) = 1", "relation_name": "analytics.facebook_ads.campaigns", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.532463Z", "completed_at": "2025-06-25T22:08:31.591462Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.594462Z", "completed_at": "2025-06-25T22:08:31.594462Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.09499764442443848, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_reltio__individual_email", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__src_reltio_individual_email as (\n\n\nwith individual_party_key as (\n    select * from analytics.external.reltio_individual_email\n)\n\nselect\n    party_key ::STRING    party_key,\n    source    ::STRING    source,\n    email     ::STRING    email,\n    loaded_at ::TIMESTAMP loaded_at\nfrom individual_party_key\n), individual_party_key as (\n    select * from __dbt__cte__src_reltio_individual_email\n)\n\nselect\n    party_key individual_party_key,\n    source,\n    (sha2(lower(trim(email :: string)), 256)) email,\n    loaded_at\nfrom individual_party_key\nwhere loaded_at >= (select max(loaded_at) from analytics.reltio.individual_email)\nqualify row_number() over (partition by party_key, email order by loaded_at desc) = 1", "relation_name": "analytics.reltio.individual_email", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.556468Z", "completed_at": "2025-06-25T22:08:31.598463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.602463Z", "completed_at": "2025-06-25T22:08:31.602463Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.051999807357788086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_reltio__individual_email_pii", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__src_reltio_individual_email as (\n\n\nwith individual_party_key as (\n    select * from analytics.external.reltio_individual_email\n)\n\nselect\n    party_key ::STRING    party_key,\n    source    ::STRING    source,\n    email     ::STRING    email,\n    loaded_at ::TIMESTAMP loaded_at\nfrom individual_party_key\n), individual_party_key as (\n    select * from __dbt__cte__src_reltio_individual_email\n)\n\nselect\n    party_key individual_party_key,\n    lower(trim(email :: string)) email,\n    loaded_at\nfrom individual_party_key\nwhere loaded_at >= (select max(loaded_at) from analytics.reltio.individual_email_pii)\nqualify row_number() over (partition by party_key, email order by loaded_at desc) = 1", "relation_name": "analytics.reltio.individual_email_pii", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.574461Z", "completed_at": "2025-06-25T22:08:31.599463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.604462Z", "completed_at": "2025-06-25T22:08:31.604462Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.05200052261352539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_reltio__individual_party_keys", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__src_reltio_individual_party_keys as (\n\n\nwith individual_party_key as (\n    select * from analytics.external.reltio_individual_party_keys\n)\n\nselect\n    party_key ::STRING    party_key,\n    entity_id ::STRING    entity_id,\n    loaded_at ::TIMESTAMP loaded_at\nfrom individual_party_key\n), individual_party_key as (\n    select * from __dbt__cte__src_reltio_individual_party_keys\n)\n\nselect\n    party_key individual_party_key,\n    entity_id individual_entity_id,\n    loaded_at loaded_at\nfrom individual_party_key\nwhere loaded_at >= (select max(loaded_at) from analytics.reltio.individual_party_keys)\nqualify row_number() over (partition by party_key order by loaded_at desc) = 1", "relation_name": "analytics.reltio.individual_party_keys", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.609463Z", "completed_at": "2025-06-25T22:08:31.712464Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.728465Z", "completed_at": "2025-06-25T22:08:31.728465Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.12800097465515137, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_rms__products", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__src_rms_products as (\n\n\nwith individual_party_key as (\n    select * from analytics.external.rms_products\n)\n\nselect\n    id        ::string    id,\n    name      ::string    name,\n    brand     ::string    brand,\n    loaded_at ::timestamp loaded_at\nfrom individual_party_key\n), products as (\n    select * from __dbt__cte__src_rms_products\n)\n\nselect\n    id        product_id,\n    name      product_name,\n    brand     brand_name,\n    loaded_at loaded_at\nfrom products\n\nwhere loaded_at >= (select max(loaded_at) from analytics.rms.products)\nqualify row_number() over (partition by product_id order by loaded_at desc) = 1", "relation_name": "analytics.rms.products", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.628462Z", "completed_at": "2025-06-25T22:08:31.815463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.817465Z", "completed_at": "2025-06-25T22:08:31.817465Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2160017490386963, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.fct_marketing__dim_customer", "compiled": true, "compiled_code": "def model(dbt, session):\r\n    session.use_schema(\"mrt_marketing\")\r\n    dbt.config(\r\n        python_version=\"3.11\",\r\n        packages=[\"faker\"],\r\n        materialization=\"incremental\",\r\n        incremental_strategy=\"merge\",\r\n        unique_key=\"account_id\"\r\n    )\r\n\r\n    from snowflake.snowpark import functions as F\r\n    from faker import Faker\r\n\r\n    fake = Faker()\r\n\r\n    @F.udf\r\n    def syn_first_name(col: str) -> str:\r\n        fake.seed_locale('en_US', col)\r\n        return fake.first_name()\r\n    \r\n    @F.udf\r\n    def syn_last_name(col: str) -> str:\r\n        fake.seed_locale('en_US', col)\r\n        return fake.last_name()\r\n\r\n\r\n    df = dbt.ref(\"stg_accounts_db__accounts\")\r\n    cols = df.columns\r\n\r\n    if dbt.is_incremental:\r\n            max_from_this = f\"select max(loaded_at) from {dbt.this}\"\r\n            df = df.filter(df[\"loaded_at\"] >= session.sql(max_from_this).collect()[0][0])\r\n\r\n    df_fn = (\r\n        df\r\n        .select(\"first_name\")\r\n        .distinct()\r\n        .with_column(\"syn_first_name\",\r\n                     F.lower(syn_first_name(F.col(\"first_name\"))))\r\n    )\r\n    \r\n    df_ln = (\r\n        df\r\n        .select(\"last_name\")\r\n        .distinct()\r\n        .with_column(\"syn_last_name\",\r\n                     F.lower(syn_last_name(F.col(\"last_name\"))))\r\n    )\r\n\r\n    df = (\r\n        df\r\n        .join(df_fn, \"first_name\")\r\n        .join(df_ln, \"last_name\")\r\n        .with_column(\"first_name\", df_fn[\"syn_first_name\"])\r\n        .with_column(\"last_name\", df_ln[\"syn_last_name\"])\r\n        .select(*cols)\r\n    )\r\n\r\n    return df\n\n\n# This part is user provided model code\n# you will need to copy the next section to run the code\n# COMMAND ----------\n# this part is dbt logic for get ref work, do not modify\n\ndef ref(*args, **kwargs):\n    refs = {\"stg_accounts_db__accounts\": \"analytics.accounts_db.accounts\"}\n    key = '.'.join(args)\n    version = kwargs.get(\"v\") or kwargs.get(\"version\")\n    if version:\n        key += f\".v{version}\"\n    dbt_load_df_function = kwargs.get(\"dbt_load_df_function\")\n    return dbt_load_df_function(refs[key])\n\n\ndef source(*args, dbt_load_df_function):\n    sources = {}\n    key = '.'.join(args)\n    return dbt_load_df_function(sources[key])\n\n\nconfig_dict = {}\n\n\nclass config:\n    def __init__(self, *args, **kwargs):\n        pass\n\n    @staticmethod\n    def get(key, default=None):\n        return config_dict.get(key, default)\n\nclass this:\n    \"\"\"dbt.this() or dbt.this.identifier\"\"\"\n    database = \"analytics\"\n    schema = \"mrt_common\"\n    identifier = \"dim_customer\"\n    \n    def __repr__(self):\n        return 'analytics.mrt_common.dim_customer'\n\n\nclass dbtObj:\n    def __init__(self, load_df_function) -> None:\n        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)\n        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)\n        self.config = config\n        self.this = this()\n        self.is_incremental = False\n\n# COMMAND ----------\n\n\n", "relation_name": "analytics.mrt_common.dim_customer", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.731465Z", "completed_at": "2025-06-25T22:08:31.823464Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.825462Z", "completed_at": "2025-06-25T22:08:31.825462Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.14999866485595703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.stg_adobe_experience__clickstream_hits", "compiled": true, "compiled_code": "\n\nwith\n __dbt__cte__src_adobe_experience_web_clickstream_hits as (\n\n\nwith web_hits as (\n    select * from analytics.external.adobe_experience_web_clickstream_hits\n)\n\nselect\n    post_visid_high ::string    post_visid_high,\n    post_visid_low  ::string    post_visid_low,\n    hitid_high      ::string    hitid_high,\n    hitid_low       ::string    hitid_low,\n    date_time       ::timestamp date_time,\n    mcvisid         ::string    mcvisid,\n    page_url        ::string    page_url,\n    post_evar133    ::string    post_evar133,\n    transactionid   ::int       transactionid,\n    loaded_at       ::timestamp loaded_at\nfrom web_hits\n),  __dbt__cte__src_adobe_experience_app_clickstream_hits as (\n\n\nwith app_hits as (\n    select * from analytics.external.adobe_experience_app_clickstream_hits\n)\n\nselect\n    post_visid_high ::string    post_visid_high,\n    post_visid_low  ::string    post_visid_low,\n    hitid_high      ::string    hitid_high,\n    hitid_low       ::string    hitid_low,\n    date_time       ::timestamp date_time,\n    mcvisid         ::string    mcvisid,\n    page_url        ::string    page_url,\n    post_evar133    ::string    post_evar133,\n    transactionid   ::int       transactionid,\n    loaded_at       ::timestamp loaded_at\nfrom app_hits\n), web_hits as (\n    select 'web' property, * from __dbt__cte__src_adobe_experience_web_clickstream_hits\n),\n\napp_hits as (\n    select 'app' property, * from __dbt__cte__src_adobe_experience_app_clickstream_hits\n),\n\naccounts as (\n    select * from analytics.accounts_db.accounts\n),\n\nunited_hits as (\nselect 'web' property, * from web_hits\nwhere loaded_at >= (select max(loaded_at) from analytics.adobe_experience.clickstream_hits where property = 'web')\n\nunion all\n\nselect 'app' property, * from app_hits\nwhere loaded_at >= (select max(loaded_at) from analytics.adobe_experience.clickstream_hits where property = 'app')\n),\n\nconformed_hits as (\n    select\n        (convert_timezone('America/Vancouver', 'UTC', date_time))                   hit_at,\n        concat_ws(':', post_visid_high, post_visid_low) visit_id,\n        concat_ws(':', visit_id, hitid_high, hitid_low) hit_id,\n        mcvisid                                         visitor_id,\n        page_url                                        hit_url,\n        post_evar133                                    account_id,\n        transactionid                                   order_id,\n        loaded_at                                       loaded_at\n    from united_hits\n)\n\nselect\n    h.* exclude(loaded_at),\n    c.individual_party_key,\n    h.loaded_at\nfrom conformed_hits h\nleft join accounts c on h.account_id = c.account_id\nqualify row_number() over (partition by hit_id order by h.loaded_at desc) = 1", "relation_name": "analytics.adobe_experience.clickstream_hits", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.832464Z", "completed_at": "2025-06-25T22:08:31.862463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.864462Z", "completed_at": "2025-06-25T22:08:31.864462Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03499746322631836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.dim_marketing__dim_campaigns", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__campaigns as (\n\n\nwith\nfacebook_ads as (\n    select * from analytics.facebook_ads.campaigns\n),\ngoogle_ads as (\n    select * from analytics.google_ads.campaigns\n)\n\nselect * from facebook_ads\n\nunion all\n\nselect * from google_ads\n), campaigns as (\n    select * from __dbt__cte__campaigns\n)\n\nselect\n    marketing_channel,\n    campaign_id,\n    campaign_name,\n    campaign_start_at,\n    loaded_at\nfrom campaigns", "relation_name": "analytics.mrt_marketing.dim_campaigns", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.850463Z", "completed_at": "2025-06-25T22:08:31.867464Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.868465Z", "completed_at": "2025-06-25T22:08:31.868465Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.021000385284423828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.int_marketing__attributions", "compiled": true, "compiled_code": "\n\nwith\nclickstream_hits as (\n    select * from analytics.adobe_experience.clickstream_hits\n),\n\nindividual_party_key as (\n    select * from analytics.reltio.individual_party_keys\n),\n\nsplit_query_string as (\n    select\n        h.hit_id,\n        h.individual_party_key,\n        h.hit_at,\n        split(h.hit_url, '?')[1] query_string,\n        h.loaded_at\n    from clickstream_hits h\n),\n\nparsed as (\n    select distinct\n        hit_id,\n        individual_party_key,\n        hit_at attribution_start_at,\n        regexp_substr(query_string, 'utm_source=([^&]*)', 1, 1, 'e', 1) utm_source,\n        regexp_substr(query_string, 'utm_campaign=([^&]*)', 1, 1, 'e', 1) utm_campaign,\n        regexp_substr(query_string, 'product_id=([^&]*)', 1, 1, 'e', 1) advertised_product_id, \n        loaded_at\n    from split_query_string\n)\n\nselect\n    (sha2(concat_ws(':', nvl(utm_campaign:: string, ''), nvl(utm_source:: string, '')),256)) campaign_sid,\n    *\nfrom parsed\nwhere utm_campaign is not null\nand loaded_at >= (select max(loaded_at) from analytics.int_marketing.attributions)", "relation_name": "analytics.int_marketing.attributions", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.898463Z", "completed_at": "2025-06-25T22:08:31.946465Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.948465Z", "completed_at": "2025-06-25T22:08:31.948465Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.07000184059143066, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.fct_marketing__fct_attribution_last_click_14d", "compiled": true, "compiled_code": "with\n    attribution as (\n        select * from analytics.int_marketing.attributions\n    ),\n    transactions as (\n        select * from analytics.csparc.transactions\n    ),\n    individual_party_keys as (\n        select * from analytics.reltio.individual_party_keys\n    ),\n    \n\n    transactions_with_entity as (\n        select\n            t.transaction_id,\n            t.product_id,\n            t.sales_channel,\n            t.transacted_at,\n            t.individual_party_key,\n            i.individual_entity_id,\n            t.loaded_at\n        from transactions t\n        inner join individual_party_keys i on t.individual_party_key = i.individual_party_key\n        where t.loaded_at >= (select max(loaded_at) from analytics.mrt_marketing.fct_attribution_last_click_14d)\n    ),\n\n    attributed as (\n        select\n            (sha2(concat_ws(':', nvl(t.product_id:: string, ''), nvl(t.transacted_at:: string, ''), nvl(t.transaction_id:: string, '')),256)) attribution_sid,\n            a.hit_id,\n            i.individual_entity_id,\n            a.campaign_sid,\n            t.transaction_id,\n            a.advertised_product_id,\n            t.product_id transacted_product_id,\n            t.sales_channel,\n            t.transacted_at,\n            a.attribution_start_at,\n            coalesce(\n                lag(a.attribution_start_at) over (\n                    partition by i.individual_entity_id\n                    order by a.attribution_start_at, a.hit_id\n                ),\n                a.attribution_start_at + interval '14 days'\n            ) attribution_end_at,\n            t.loaded_at\n        from attribution a\n        inner join individual_party_keys i on a.individual_party_key = i.individual_party_key\n        inner join transactions_with_entity t on true\n            and i.individual_entity_id = t.individual_entity_id\n            and t.transacted_at >= a.attribution_start_at\n        \n        where true\n            \n            and a.loaded_at >= (select max(loaded_at) - interval '14 days' from analytics.mrt_marketing.fct_attribution_last_click_14d)\n        \n        qualify t.transacted_at < attribution_end_at\n    )\n\n    select\n        *\n    from attributed\n    qualify 1 = row_number() over (partition by attribution_sid order by attribution_start_at desc)\n\n", "relation_name": "analytics.mrt_marketing.fct_attribution_last_click_14d", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.916463Z", "completed_at": "2025-06-25T22:08:31.979464Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.984464Z", "completed_at": "2025-06-25T22:08:31.984464Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.10500168800354004, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.fct_marketing__fct_attribution_last_click_14d_same_brand", "compiled": true, "compiled_code": "with\n    attribution as (\n        select * from analytics.int_marketing.attributions\n    ),\n    transactions as (\n        select * from analytics.csparc.transactions\n    ),\n    individual_party_keys as (\n        select * from analytics.reltio.individual_party_keys\n    ),\n    products as (\n            select * from analytics.rms.products\n        ),\n\n    transactions_with_entity as (\n        select\n            t.transaction_id,\n            t.product_id,\n            t.sales_channel,\n            t.transacted_at,\n            t.individual_party_key,\n            i.individual_entity_id,\n            t.loaded_at\n        from transactions t\n        inner join individual_party_keys i on t.individual_party_key = i.individual_party_key\n        where t.loaded_at >= (select max(loaded_at) from analytics.mrt_marketing.fct_attribution_last_click_14d_same_brand)\n    ),\n\n    attributed as (\n        select\n            (sha2(concat_ws(':', nvl(t.product_id:: string, ''), nvl(t.transacted_at:: string, ''), nvl(t.transaction_id:: string, '')),256)) attribution_sid,\n            a.hit_id,\n            i.individual_entity_id,\n            a.campaign_sid,\n            t.transaction_id,\n            a.advertised_product_id,\n            t.product_id transacted_product_id,\n            t.sales_channel,\n            t.transacted_at,\n            a.attribution_start_at,\n            coalesce(\n                lag(a.attribution_start_at) over (\n                    partition by i.individual_entity_id\n                    order by a.attribution_start_at, a.hit_id\n                ),\n                a.attribution_start_at + interval '14 days'\n            ) attribution_end_at,\n            t.loaded_at\n        from attribution a\n        inner join individual_party_keys i on a.individual_party_key = i.individual_party_key\n        inner join transactions_with_entity t on true\n            and i.individual_entity_id = t.individual_entity_id\n            and t.transacted_at >= a.attribution_start_at\n        inner join products ap on a.advertised_product_id = ap.product_id\n            inner join products tp on t.product_id = tp.product_id\n        where true\n            and ap.brand_name = tp.brand_name\n                \n            and a.loaded_at >= (select max(loaded_at) - interval '14 days' from analytics.mrt_marketing.fct_attribution_last_click_14d_same_brand)\n        \n        qualify t.transacted_at < attribution_end_at\n    )\n\n    select\n        *\n    from attributed\n    qualify 1 = row_number() over (partition by attribution_sid order by attribution_start_at desc)\n\n", "relation_name": "analytics.mrt_marketing.fct_attribution_last_click_14d_same_brand", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.956464Z", "completed_at": "2025-06-25T22:08:31.982465Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:31.990464Z", "completed_at": "2025-06-25T22:08:31.990464Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03800010681152344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.fct_marketing__fct_attribution_last_click_30d", "compiled": true, "compiled_code": "with\n    attribution as (\n        select * from analytics.int_marketing.attributions\n    ),\n    transactions as (\n        select * from analytics.csparc.transactions\n    ),\n    individual_party_keys as (\n        select * from analytics.reltio.individual_party_keys\n    ),\n    \n\n    transactions_with_entity as (\n        select\n            t.transaction_id,\n            t.product_id,\n            t.sales_channel,\n            t.transacted_at,\n            t.individual_party_key,\n            i.individual_entity_id,\n            t.loaded_at\n        from transactions t\n        inner join individual_party_keys i on t.individual_party_key = i.individual_party_key\n        where t.loaded_at >= (select max(loaded_at) from analytics.mrt_marketing.fct_attribution_last_click_30d)\n    ),\n\n    attributed as (\n        select\n            (sha2(concat_ws(':', nvl(t.product_id:: string, ''), nvl(t.transacted_at:: string, ''), nvl(t.transaction_id:: string, '')),256)) attribution_sid,\n            a.hit_id,\n            i.individual_entity_id,\n            a.campaign_sid,\n            t.transaction_id,\n            a.advertised_product_id,\n            t.product_id transacted_product_id,\n            t.sales_channel,\n            t.transacted_at,\n            a.attribution_start_at,\n            coalesce(\n                lag(a.attribution_start_at) over (\n                    partition by i.individual_entity_id\n                    order by a.attribution_start_at, a.hit_id\n                ),\n                a.attribution_start_at + interval '30 days'\n            ) attribution_end_at,\n            t.loaded_at\n        from attribution a\n        inner join individual_party_keys i on a.individual_party_key = i.individual_party_key\n        inner join transactions_with_entity t on true\n            and i.individual_entity_id = t.individual_entity_id\n            and t.transacted_at >= a.attribution_start_at\n        \n        where true\n            \n            and a.loaded_at >= (select max(loaded_at) - interval '30 days' from analytics.mrt_marketing.fct_attribution_last_click_30d)\n        \n        qualify t.transacted_at < attribution_end_at\n    )\n\n    select\n        *\n    from attributed\n    qualify 1 = row_number() over (partition by attribution_sid order by attribution_start_at desc)\n\n", "relation_name": "analytics.mrt_marketing.fct_attribution_last_click_30d", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.932462Z", "completed_at": "2025-06-25T22:08:31.989463Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:32.014464Z", "completed_at": "2025-06-25T22:08:32.014464Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.13100099563598633, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.fct_marketing__fct_attribution_last_click_14d_same_sku", "compiled": true, "compiled_code": "with\n    attribution as (\n        select * from analytics.int_marketing.attributions\n    ),\n    transactions as (\n        select * from analytics.csparc.transactions\n    ),\n    individual_party_keys as (\n        select * from analytics.reltio.individual_party_keys\n    ),\n    products as (\n            select * from analytics.rms.products\n        ),\n\n    transactions_with_entity as (\n        select\n            t.transaction_id,\n            t.product_id,\n            t.sales_channel,\n            t.transacted_at,\n            t.individual_party_key,\n            i.individual_entity_id,\n            t.loaded_at\n        from transactions t\n        inner join individual_party_keys i on t.individual_party_key = i.individual_party_key\n        where t.loaded_at >= (select max(loaded_at) from analytics.mrt_marketing.fct_attribution_last_click_14d_same_sku)\n    ),\n\n    attributed as (\n        select\n            (sha2(concat_ws(':', nvl(t.product_id:: string, ''), nvl(t.transacted_at:: string, ''), nvl(t.transaction_id:: string, '')),256)) attribution_sid,\n            a.hit_id,\n            i.individual_entity_id,\n            a.campaign_sid,\n            t.transaction_id,\n            a.advertised_product_id,\n            t.product_id transacted_product_id,\n            t.sales_channel,\n            t.transacted_at,\n            a.attribution_start_at,\n            coalesce(\n                lag(a.attribution_start_at) over (\n                    partition by i.individual_entity_id\n                    order by a.attribution_start_at, a.hit_id\n                ),\n                a.attribution_start_at + interval '14 days'\n            ) attribution_end_at,\n            t.loaded_at\n        from attribution a\n        inner join individual_party_keys i on a.individual_party_key = i.individual_party_key\n        inner join transactions_with_entity t on true\n            and i.individual_entity_id = t.individual_entity_id\n            and t.transacted_at >= a.attribution_start_at\n        inner join products ap on a.advertised_product_id = ap.product_id\n            inner join products tp on t.product_id = tp.product_id\n        where true\n            and ap.product_id = tp.product_id\n                \n            and a.loaded_at >= (select max(loaded_at) - interval '14 days' from analytics.mrt_marketing.fct_attribution_last_click_14d_same_sku)\n        \n        qualify t.transacted_at < attribution_end_at\n    )\n\n    select\n        *\n    from attributed\n    qualify 1 = row_number() over (partition by attribution_sid order by attribution_start_at desc)\n\n", "relation_name": "analytics.mrt_marketing.fct_attribution_last_click_14d_same_sku", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:32.052464Z", "completed_at": "2025-06-25T22:08:32.069467Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:32.074463Z", "completed_at": "2025-06-25T22:08:32.074463Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05199933052062988, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.fct_marketing__fct_attribution_last_click_30d_same_sku", "compiled": true, "compiled_code": "with\n    attribution as (\n        select * from analytics.int_marketing.attributions\n    ),\n    transactions as (\n        select * from analytics.csparc.transactions\n    ),\n    individual_party_keys as (\n        select * from analytics.reltio.individual_party_keys\n    ),\n    products as (\n            select * from analytics.rms.products\n        ),\n\n    transactions_with_entity as (\n        select\n            t.transaction_id,\n            t.product_id,\n            t.sales_channel,\n            t.transacted_at,\n            t.individual_party_key,\n            i.individual_entity_id,\n            t.loaded_at\n        from transactions t\n        inner join individual_party_keys i on t.individual_party_key = i.individual_party_key\n        where t.loaded_at >= (select max(loaded_at) from analytics.mrt_marketing.fct_attribution_last_click_30d_same_sku)\n    ),\n\n    attributed as (\n        select\n            (sha2(concat_ws(':', nvl(t.product_id:: string, ''), nvl(t.transacted_at:: string, ''), nvl(t.transaction_id:: string, '')),256)) attribution_sid,\n            a.hit_id,\n            i.individual_entity_id,\n            a.campaign_sid,\n            t.transaction_id,\n            a.advertised_product_id,\n            t.product_id transacted_product_id,\n            t.sales_channel,\n            t.transacted_at,\n            a.attribution_start_at,\n            coalesce(\n                lag(a.attribution_start_at) over (\n                    partition by i.individual_entity_id\n                    order by a.attribution_start_at, a.hit_id\n                ),\n                a.attribution_start_at + interval '30 days'\n            ) attribution_end_at,\n            t.loaded_at\n        from attribution a\n        inner join individual_party_keys i on a.individual_party_key = i.individual_party_key\n        inner join transactions_with_entity t on true\n            and i.individual_entity_id = t.individual_entity_id\n            and t.transacted_at >= a.attribution_start_at\n        inner join products ap on a.advertised_product_id = ap.product_id\n            inner join products tp on t.product_id = tp.product_id\n        where true\n            and ap.product_id = tp.product_id\n                \n            and a.loaded_at >= (select max(loaded_at) - interval '30 days' from analytics.mrt_marketing.fct_attribution_last_click_30d_same_sku)\n        \n        qualify t.transacted_at < attribution_end_at\n    )\n\n    select\n        *\n    from attributed\n    qualify 1 = row_number() over (partition by attribution_sid order by attribution_start_at desc)\n\n", "relation_name": "analytics.mrt_marketing.fct_attribution_last_click_30d_same_sku", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:32.027463Z", "completed_at": "2025-06-25T22:08:32.072464Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:32.077463Z", "completed_at": "2025-06-25T22:08:32.077463Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.05800008773803711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.analytics.fct_marketing__fct_attribution_last_click_30d_same_brand", "compiled": true, "compiled_code": "with\n    attribution as (\n        select * from analytics.int_marketing.attributions\n    ),\n    transactions as (\n        select * from analytics.csparc.transactions\n    ),\n    individual_party_keys as (\n        select * from analytics.reltio.individual_party_keys\n    ),\n    products as (\n            select * from analytics.rms.products\n        ),\n\n    transactions_with_entity as (\n        select\n            t.transaction_id,\n            t.product_id,\n            t.sales_channel,\n            t.transacted_at,\n            t.individual_party_key,\n            i.individual_entity_id,\n            t.loaded_at\n        from transactions t\n        inner join individual_party_keys i on t.individual_party_key = i.individual_party_key\n        where t.loaded_at >= (select max(loaded_at) from analytics.mrt_marketing.fct_attribution_last_click_30d_same_brand)\n    ),\n\n    attributed as (\n        select\n            (sha2(concat_ws(':', nvl(t.product_id:: string, ''), nvl(t.transacted_at:: string, ''), nvl(t.transaction_id:: string, '')),256)) attribution_sid,\n            a.hit_id,\n            i.individual_entity_id,\n            a.campaign_sid,\n            t.transaction_id,\n            a.advertised_product_id,\n            t.product_id transacted_product_id,\n            t.sales_channel,\n            t.transacted_at,\n            a.attribution_start_at,\n            coalesce(\n                lag(a.attribution_start_at) over (\n                    partition by i.individual_entity_id\n                    order by a.attribution_start_at, a.hit_id\n                ),\n                a.attribution_start_at + interval '30 days'\n            ) attribution_end_at,\n            t.loaded_at\n        from attribution a\n        inner join individual_party_keys i on a.individual_party_key = i.individual_party_key\n        inner join transactions_with_entity t on true\n            and i.individual_entity_id = t.individual_entity_id\n            and t.transacted_at >= a.attribution_start_at\n        inner join products ap on a.advertised_product_id = ap.product_id\n            inner join products tp on t.product_id = tp.product_id\n        where true\n            and ap.brand_name = tp.brand_name\n                \n            and a.loaded_at >= (select max(loaded_at) - interval '30 days' from analytics.mrt_marketing.fct_attribution_last_click_30d_same_brand)\n        \n        qualify t.transacted_at < attribution_end_at\n    )\n\n    select\n        *\n    from attributed\n    qualify 1 = row_number() over (partition by attribution_sid order by attribution_start_at desc)\n\n", "relation_name": "analytics.mrt_marketing.fct_attribution_last_click_30d_same_brand", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-25T22:08:31.888462Z", "completed_at": "2025-06-25T22:08:32.598464Z"}, {"name": "execute", "started_at": "2025-06-25T22:08:32.600462Z", "completed_at": "2025-06-25T22:08:32.600462Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.7249982357025146, "adapter_response": {}, "message": null, "failures": null, "unique_id": "analysis.analytics.test", "compiled": true, "compiled_code": "with\n    attribution as (\n        select * from analytics.int_marketing.attributions\n    ),\n    transactions as (\n        select * from analytics.csparc.transactions\n    ),\n    individual_party_keys as (\n        select * from analytics.reltio.individual_party_keys\n    ),\n    products as (\n            select * from analytics.rms.products\n        ),\n\n    transactions_with_entity as (\n        select\n            t.transaction_id,\n            t.product_id,\n            t.sales_channel,\n            t.transacted_at,\n            t.individual_party_key,\n            i.individual_entity_id,\n            t.loaded_at\n        from transactions t\n        inner join individual_party_keys i on t.individual_party_key = i.individual_party_key\n        \n    ),\n\n    attributed as (\n        select\n            (sha2(concat_ws(':', nvl(t.product_id:: string, ''), nvl(t.transacted_at:: string, ''), nvl(t.transaction_id:: string, '')),256)) attribution_sid,\n            a.hit_id,\n            i.individual_entity_id,\n            a.campaign_sid,\n            t.transaction_id,\n            a.advertised_product_id,\n            t.product_id transacted_product_id,\n            t.sales_channel,\n            t.transacted_at,\n            a.attribution_start_at,\n            coalesce(\n                lag(a.attribution_start_at) over (\n                    partition by i.individual_entity_id\n                    order by a.attribution_start_at, a.hit_id\n                ),\n                a.attribution_start_at + interval '14 days'\n            ) attribution_end_at,\n            t.loaded_at\n        from attribution a\n        inner join individual_party_keys i on a.individual_party_key = i.individual_party_key\n        inner join transactions_with_entity t on true\n            and i.individual_entity_id = t.individual_entity_id\n            and t.transacted_at >= a.attribution_start_at\n        inner join products ap on a.advertised_product_id = ap.product_id\n            inner join products tp on t.product_id = tp.product_id\n        where true\n            and ap.brand_name = tp.brand_name\n                and ap.product_id = tp.product_id\n                \n        qualify t.transacted_at < attribution_end_at\n    )\n\n    select\n        *\n    from attributed\n    qualify 1 = row_number() over (partition by attribution_sid order by attribution_start_at desc)\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 4.398998737335205, "args": {"profiles_dir": "C:\\Users\\Andrew\\.dbt", "compile": true, "select": [], "static_parser": true, "require_yaml_configuration_for_mf_time_spines": false, "require_resource_names_without_spaces": false, "use_colors_file": true, "log_path": "Z:\\Users\\Andrew\\Documents\\code\\dbt\\marketing\\logs", "write_json": true, "partial_parse_file_diff": true, "printer_width": 80, "send_anonymous_usage_stats": true, "project_dir": "Z:\\Users\\Andrew\\Documents\\code\\dbt\\marketing", "log_format": "default", "cache_selected_only": false, "partial_parse": true, "defer": false, "populate_cache": true, "print": true, "version_check": true, "indirect_selection": "eager", "empty_catalog": false, "use_colors": true, "source_freshness_run_project_hooks": false, "state_modified_compare_more_unrendered_values": false, "quiet": false, "show_resource_report": false, "log_level_file": "debug", "invocation_command": "dbt docs generate", "state_modified_compare_vars": false, "log_format_file": "debug", "log_level": "info", "vars": {}, "strict_mode": false, "require_nested_cumulative_type_params": false, "static": false, "warn_error_options": {"include": [], "exclude": []}, "log_file_max_bytes": 10485760, "which": "generate", "introspect": true, "require_batched_execution_for_custom_microbatch_strategy": false, "require_explicit_package_overrides_for_builtin_materializations": true, "exclude": [], "macro_debugging": false, "skip_nodes_if_on_run_start_fails": false, "favor_state": false}}